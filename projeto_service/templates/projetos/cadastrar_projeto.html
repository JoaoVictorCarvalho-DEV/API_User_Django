{% extends "../base/base.html" %}

{% block template %}
<div class="container mx-auto px-4 py-8">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">
            <i class="bi bi-bookmark-check-fill mr-2"></i>Cadastrar Projeto
        </h1>
    </div>

    <div class="flex justify-center">
        <div class="w-full max-w-2xl bg-white rounded-lg shadow-md p-6">
            <form id="formProjeto" class="space-y-6">
                {% csrf_token %}

                <!-- Nome do Projeto -->
                <div>
                    <label for="inputName" class="block text-sm font-medium text-gray-700">Nome do Projeto</label>
                    <input type="text" id="inputName" name="inputName" maxlength="50" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <div class="invalid-feedback hidden text-red-600 text-sm mt-1">
                        O nome do projeto deve ter entre 1 e 50 caracteres.
                    </div>
                    <div class="text-right text-sm text-gray-500 mt-1">
                        <span id="nomeCounter">0</span>/50 caracteres
                    </div>
                </div>

                <!-- Descrição -->
                <div>
                    <label for="descricao" class="block text-sm font-medium text-gray-700">Descrição</label>
                    <textarea id="descricao" name="descricao" rows="3" required
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    <div class="invalid-feedback hidden text-red-600 text-sm mt-1">
                        Por favor, insira uma descrição.
                    </div>
                </div>

                <!-- Datas -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="dataInicio" class="block text-sm font-medium text-gray-700">Data Inicial</label>
                        <input type="date" id="dataInicio" name="dataInicio" required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <div class="invalid-feedback hidden text-red-600 text-sm mt-1">
                            Por favor, selecione a data inicial.
                        </div>
                    </div>
                    <div>
                        <label for="dataFinal" class="block text-sm font-medium text-gray-700">Data Final</label>
                        <input type="date" id="dataFinal" name="dataFinal" required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <div class="invalid-feedback hidden text-red-600 text-sm mt-1">
                            Por favor, selecione a data final.
                        </div>
                    </div>
                </div>

                <!-- Atribuições -->
                <div class="space-y-4">
                    <h5 class="text-center text-lg font-medium text-gray-700">Atribuições</h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Órgão -->
                        <div>
                            <label for="orgaoId" class="block text-sm font-medium text-gray-700">Órgão</label>
                            <select id="orgaoId" name="orgaoId" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="" selected disabled>Selecione</option>
                            </select>
                            <div class="invalid-feedback hidden text-red-600 text-sm mt-1">
                                Por favor, selecione um órgão.
                            </div>
                        </div>

                        <!-- Analista -->
                        <div>
                            <label for="analista" class="block text-sm font-medium text-gray-700">Analista</label>
                            <select id="analista" name="analista" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="" selected disabled>Selecione</option>
                            </select>
                            <div class="invalid-feedback hidden text-red-600 text-sm mt-1">
                                Por favor, selecione um analista.
                            </div>
                        </div>

                        <!-- Desenvolvedor -->
                        <div>
                            <label for="desenvolvedor" class="block text-sm font-medium text-gray-700">Desenvolvedor</label>
                            <select id="desenvolvedor" name="desenvolvedor" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="" selected disabled>Selecione</option>
                            </select>
                            <div class="invalid-feedback hidden text-red-600 text-sm mt-1">
                                Por favor, selecione um desenvolvedor.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botão de Envio -->
                <div>
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Enviar
                    </button>
                </div>
            </form>

            <!-- Mensagem de Feedback -->
            <div id="message" class="hidden mt-4 p-4 rounded"></div>
        </div>
    </div>
</div>

<script>
    // Contador de caracteres para o nome do projeto
    document.getElementById('inputName').addEventListener('input', function() {
        const counter = document.getElementById('nomeCounter');
        const currentLength = this.value.length;
        counter.textContent = currentLength;

        if (currentLength > 45) {
            counter.classList.add('text-orange-500', 'font-bold');
            if (currentLength >= 50) {
                counter.classList.remove('text-orange-500');
                counter.classList.add('text-red-600');
            }
        } else {
            counter.classList.remove('text-orange-500', 'text-red-600', 'font-bold');
        }
    });


</script>

    {% load static %}
<script src="{% static 'projeto_service/js/cadastrar_projeto.js' %}"></script>
    
<script>
        carregarOrgaoForm()
        carregarAnalistaForm()
        carregarDesenvolvedorForm()
</script>

<style>
        /* Estilo opcional para o contador */
        .text-warning { color: orange; font-weight: bold; }
        .text-danger { color: red; font-weight: bold; }
</style>
{% endblock %}